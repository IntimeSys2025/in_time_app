

        name: Flutter CI
        on:
          push:
            branches: [ "master" ]
          pull_request:
            branches: [ "master" ]

        jobs:
          build:
            runs-on: ubuntu-latest

            steps:
#              - uses: actions/checkout@v4
              #1 Checkout Repository
              - name: Checkout Repository
                uses: actions/checkout@v4

                #2 Setup Java
              - name: Set Up Java
                uses: actions/setup-java@v3.12.0
                with:
                    distribution: 'oracle'
                    java-version: '17'

                #3 Setup Flutter
              - name: Set Up Flutter
                uses: subosito/flutter-action@v2
                with:
                  flutter-version: '3.29.2'
                  channel: 'stable'

              #4 Enable dependency caching (super important!)
              - name: Cache Flutter packages
                uses: actions/cache@v3
                with:
                  path: |
                    ~/.pub-cache
                        build
                  key: ${{ runner.os }}-pub-${{ hashFiles('pubspec.lock') }}


              - name: Clean
                run: flutter clean

              - name: Install dependencies
                run: flutter pub get

              - name: Build APK
                run: flutter build apk --release


              # 7) Upload APK as artifact (optional but recommended)
              - name: Upload APK
                uses: actions/upload-artifact@v4
                with:
                 name: app-release
                 path: build/app/outputs/flutter-apk/app-release.apk
                   
                   
                #7) Install Firebase CLI
              - name: Install Firebase CLI
                run: |
                   curl -sL https://firebase.tools | bash



#                #8) Upload to Firebase App Distribution
#              - name: Firebase Login
#                env:
#                  FIREBASE_SERVICE_ACCOUNT: ${{ secrets.FIREBASE_SERVICE_ACCOUNT }}
#                run: |
#                  echo "$FIREBASE_SERVICE_ACCOUNT" > serviceAccount.json
#                  firebase auth:login:ci --token="$(firebase functions:config:set firebase.json --json "$(cat serviceAccount.json)" 2>/dev/null)"

              # Save service account file
              - name: Create serviceAccount.json
                run: echo "${{ secrets.FIREBASE_SERVICE_ACCOUNT }}" > serviceAccount.json

              # Authenticate using service account
              - name: Set GOOGLE_APPLICATION_CREDENTIALS
                run: echo "GOOGLE_APPLICATION_CREDENTIALS=$(pwd)/serviceAccount.json" >> $GITHUB_ENV


               #9) Upload to Firebase App Distribution

              - name: Upload to Firebase App Distribution
                env:
                  FIREBASE_APP_ID: ${{ secrets.FIREBASE_APP_ID }}
                  FIREBASE_TESTERS: ${{ secrets.FIREBASE_TESTERS }}
                run: |
                  firebase appdistribution:distribute \
                  build/app/outputs/flutter-apk/app-release.apk \
                  --app $FIREBASE_APP_ID \
                  --testers "$FIREBASE_TESTERS" \
                  --release-notes "First CI build ðŸš€"

